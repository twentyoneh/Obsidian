## Модуль вложенных векторных прерываний #NVIC
![[Pasted image 20240710113201.png]]
На уровне контроллера NVIC все прерывания делятся на два типа – **прерывания от периферийных устройств** или **внешние и дополнительные или внутренние**. К внутренним относятся разнообразные процессорные исключения, события системного таймера, и встроенного отладчика. Для разработки конечных приложений эти элементы используются редко, гораздо больший интерес представляют внешние прерывания. Данные сигналы поступают в контроллер NVIC по отдельным линиям, каждая из которых имеет свой номер и приоритет. Для расширения возможностей и повышения гибкости настроек часть периферийных устройств STM32 подключена не напрямую к NVIC, а к внешнему контроллеру EXTI(External Interrupt).

## Регистры NVIC
Большое количество векторов прерываний в Cortex-M3 не позволяет разместить их все в одном регистре. Поэтому в составе NVIC имеется по три регистра каждого типа с номерами 1,2,3. Учитывая, что все они практически одинаковы и отличаются только обслуживаемыми номерами векторов прерываний, нет смысла описывать все регистры. Ниже приведена информация только по элементам с номером 1. (все регистры перечислены тут) https://mcucpu.ru/index.php/platformy-32-bit/stm32/150-preryvaniya-v-stm32


------------------------------------------------------

### Приоритеты прерываний 
NVIC же приоритетный контроллер. Но что то никто на это, как я погляжу, не заморачивается особо. Как лепили одноранговые прерывания на AVR так и тут лепят.
По дефолту более высокий уровень приоритета имеют только группа FIQ. У остальных же он одинаковый. Как на AVR. Т.е. кто раньше встал — того и тапки. Одноранговое прерывание не может перебить другое такое же. А если случилось так, что несколько прерываний встали на ожидание, но не смогли пойти на выполнение (т.к., например, был глобальный запрет, либо выполнялось прерывание), то как только появится возможность первым пойдет то прерывание, чей номер в таблице векторов меньше. Ну как на AVR.
Байт приоритета можно вкатить вручную, засунув его в старшую тетраду нужного поля, но куда наглядней вызвать функцию CMSIS, например так:  

```
//Понижаем приоритет прерыванию EXTI2
NVIC_SetPriority (EXTI2_IRQn, 2);
```

Вот, парочка примеров:  
Два равных прерывания пришли с перехлестом:
![[Pasted image 20240710122127.png]]
А вот более важное перебивает низкоприоритетное:
![[Pasted image 20240710122139.png]]
