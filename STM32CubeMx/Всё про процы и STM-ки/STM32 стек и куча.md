

![[Pasted image 20240709174542.png]]
Конечно же в вашем микроконтроллере нет никаких гигабайтов памяти однако камень 32-х битный, а значит можно адресовать _(обратится по адресу)_ до 4ГБ. Это стандартизированная модель обеспечивающая переносимость кода между различными микроконтроллерами stm32, а так же дающая возможность подключать внешнюю память и совершенно спокойно обращаться к ней. То же самое касается и периферии, производитель микроконтроллеров на базе ядра Cortex, может напихать туда оооочень много всего и при этом не беспокоиться о нехватке адресов. Что же касается размера, то некоторых адресов просто нет, вместо них зарезервированные пустоты. Если обратится к зарезервированной области, то произойдёт аппаратный сбой процессора.

SRAM — это оперативная память, а Code Area выглядит так
![[Pasted image 20240710090938.png]]

--------------------------------------------------------------
**Стек** — область памяти в ОЗУ, куда сохраняется адреса программы в момент возникновения прерывания или перехода в другую функцию.

_Наша программа работает-работает (указатель «бежит» последовательно по адресам).  
  
Происходит прерывание — указатель перепрыгивает в обработчик этого прерывания.  
  
Адрес, где находилась программа в момент возникновения прерывания, записывается в стек (чтоб запомнить куда возвращаться).  
  
После того как обработка прерывания закончится, из стека вытаскивается адрес на который нужно вернуться._  
  
То же самое происходит при переходе из одной функции в другую, например из ![](https://istarik.ru/uploads/images/00/00/01/2019/09/27/0ae8f0.jpg) в ![](https://istarik.ru/uploads/images/00/00/01/2019/09/27/d2b35a.jpg)

Технически, стек можно представить в виде стопки книг где нельзя взять вторую сверху книгу не сняв предварительно первую. То есть стек работает по принципу **LIFO буфера _(Last In First Out)_ — «последним пришёл, первым вышел».** Такая организация очень хорошо себя оправдывает. Представьте себе такую ситуацию:  
  
_Указатель перепрыгнул из функции main() в bla_bla().  
  
В стек записался адрес того места откуда выпрыгнул указатель.  
  
Идёт обработка функции bla_bla() и в этот момент происходит прерывание.  
  
В стек записывается (ложится поверх предыдущего) ещё один адрес, и указатель переходит в обработчик прерывания.  
  
В результате на стеке лежат два адреса — адрес, на котором была приостановлена функция main(), а поверх него адрес на котором приостановлена функция bla_bla()._  
  
По окончании обработки прерывания система лезет в стек, «снимает со стопки» самый последний адрес, переходит по нему и заканчивает выполнение функции bla_bla() с того места где она была прервана. Больше этот адрес не нужен и он выкидывается в помойку, на стеке остаётся адрес приостановки функции main().  
  
Как только функция bla_bla() завершается, система опять лезет в стек и «снимает» адрес приостановки функции main(). Адрес опять же летит в помойку, а функция main() продолжает выполняться. Таким образом, снимая «книжку за книжкой» система не сможет вернуться куда-то не туда и нарушить целостность программы.

***Помимо адресов, в стек сохраняются локальные переменные функций и параметры передающиеся в функции. То есть в момент вызова функции, вместе с адресом для возврата, на стек кладутся ещё и локальные переменные, которые есть в этой функции. Как только функция отработает, эти переменные будут сняты со стека и уничтожены.***

**Куча** - эта область ОЗУ, которая используется для динамического выделения памяти в процессе работы программы. То есть, когда вы делаете malloc/calloc/realloc, то память выделяется на куче.

**bss** — область ОЗУ, сюда помещаются неинициализированные глобальные переменные _(uint8_t var;)_.  
  
**data** — область ОЗУ, сюда помещаются инициализированные глобальные переменные _(uint8_t var = 0;)_.  
  
**text** — Flash, здесь лежит сама программа.

***_Стек начинается от самого большого адреса и при увеличении размера ползёт вниз _(записывая данные в меньшие адреса)_, а куча наоборот, при увеличении размера ползёт вверх, поэтому при выделении памяти на куче нужно следить чтоб эти области не налезли друг на друга.***

![[Pasted image 20240710101553.png]]

